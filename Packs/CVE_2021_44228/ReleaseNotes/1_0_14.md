#### Playbooks

##### New: CVE-2021-44228 - Log4j RCE

- New: Critical RCE Vulnerability: log4j - CVE-2021-44228

On Dec. 9, 2021, a remote code execution (RCE) vulnerability in Apache log4j 2 was identified being exploited in the wild. Public proof of concept (PoC) code was released and subsequent investigation revealed that exploitation was incredibly easy to perform. 

On Dec. 14 2021, another vulnerability was discovered related to the log4j 0-day exploit known as CVE-2021-45046.

On Dec 18 2021, yet another vulnerability was discovered related to the log4j 0-day exploit known as CVE-2021-45105 that allows an attacker with control over Thread Context Map data to cause a denial of service when a crafted string is interpreted. This issue was fixed in Log4j 2.17.0 and 2.12.3.

On Dec 28 2021, another RCE vulnerability was published for Apache Log4j2, versions 2.0-beta7 through 2.17.0 (excluding security fix releases 2.3.2 and 2.12.4).
In order to exploit this vulnerability, an attacker with permission to modify the logging configuration file can construct a malicious configuration using a JDBC Appender with a data source referencing a JNDI URI which can execute remote code. This issue is fixed by limiting JNDI data source names to the java protocol in Log4j2 versions 2.17.1, 2.12.4, and 2.3.2.

**Affected Version**

Apache Log4j 2.x <= 2.17.0

This playbook should be triggered manually or can be configured as a job.
Please create a new incident and choose the **CVE-2021-44228 - Log4j RCE** playbook and **Rapid Breach Response** incident type.

**The playbook includes the following tasks:**

* Collect related known indicators from several sources.
* Indicators and exploitation patterns hunting using PAN-OS, Cortex XDR and SIEM products.
*Search for possible vulnerable servers using Xpanse and Prisma Cloud.
* Block indicators automatically or manually.

**Mitigations:**
* Apache official CVE-2021-44228 patch.
* Unit42 recommended mitigations.
* Detection Rules.
    * Snort
    * Suricata
    * Sigma
    * Yara
    * Zeek Intel

More information:
[Apache Log4j Vulnerability Is Actively Exploited in the Wild (CVE-2021-44228)](https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/)

Note: This is a beta playbook, which lets you implement and test pre-release software. Since the playbook is beta, it might contain bugs. Updates to the pack during the beta phase might include non-backward compatible features. We appreciate your feedback on the quality and usability of the pack to help us identify issues, fix them, and continually improve.

##### CVE-2021-44228 - Log4j RCE
- Replaced the **Block Indicators - Generic v2** sub-playbook with the new **Block Indicators - Generic v3** playbook. (Available from Cortex XSOAR 6.5.0).
- Added the *AutoBlockIndicators* input. This input determines whether to block the indicators automatically or manually using the **Block Indicators - Generic v3** sub-playbook. (Available from Cortex XSOAR 6.5.0).
- Added the *UserVerification* input. This input determines whether blocking IPs should be done with or without user verification.  The IPs blocking is done by using the **Block Indicators - Generic v3** sub-playbook. (Available from Cortex XSOAR 6.5.0)
- Replaced sub-playbook Cortex XDR - Execute commands with new ***xdr-script-commands-execute*** command.
- Added configuration `fromversion: 6.0.0` and `toversion: 6.4.9`
- Added configuration `toversion: 6.5.0`